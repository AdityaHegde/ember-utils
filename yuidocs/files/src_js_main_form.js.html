<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/js/main/form.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Alerts.AlertMessage.html">Alerts.AlertMessage</a></li>
            
                <li><a href="../classes/AppWrapper.AppWrapper.html">AppWrapper.AppWrapper</a></li>
            
                <li><a href="../classes/DragDrop.DraggableMixin.html">DragDrop.DraggableMixin</a></li>
            
                <li><a href="../classes/DragDrop.DroppableMixin.html">DragDrop.DroppableMixin</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextCollapsibleColumnDataMixin.html">GlobalModules.DisplayTextCollapsibleColumnDataMixin</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextCollapsibleGlypiconColumnDataMixin.html">GlobalModules.DisplayTextCollapsibleGlypiconColumnDataMixin</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextCollapsibleGlypiconView.html">GlobalModules.DisplayTextCollapsibleGlypiconView</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextCollapsibleView.html">GlobalModules.DisplayTextCollapsibleView</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextColumnDataMixin.html">GlobalModules.DisplayTextColumnDataMixin</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextView.html">GlobalModules.DisplayTextView</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextWithTooltipColumnDataMixin.html">GlobalModules.DisplayTextWithTooltipColumnDataMixin</a></li>
            
                <li><a href="../classes/GlobalModules.DisplayTextWithTooltipView.html">GlobalModules.DisplayTextWithTooltipView</a></li>
            
                <li><a href="../classes/GlobalModules.GlobalModuleColumnDataGroupMixin.html">GlobalModules.GlobalModuleColumnDataGroupMixin</a></li>
            
                <li><a href="../classes/LazyDisplay.LazyDisplayColumnDataGroup.html">LazyDisplay.LazyDisplayColumnDataGroup</a></li>
            
                <li><a href="../classes/LazyDisplay.LazyDisplayView.html">LazyDisplay.LazyDisplayView</a></li>
            
                <li><a href="../classes/ListGroup.ListColumnData.html">ListGroup.ListColumnData</a></li>
            
                <li><a href="../classes/ListGroup.ListColumnDataGroup.html">ListGroup.ListColumnDataGroup</a></li>
            
                <li><a href="../classes/ListGroup.ListGroupView.html">ListGroup.ListGroupView</a></li>
            
                <li><a href="../classes/ListGroup.ListItemView.html">ListGroup.ListItemView</a></li>
            
                <li><a href="../classes/model-wrapper.html">model-wrapper</a></li>
            
                <li><a href="../classes/ModelWrapper.ModelWrapper.html">ModelWrapper.ModelWrapper</a></li>
            
                <li><a href="../classes/Panels.PanelCollapsibleView.html">Panels.PanelCollapsibleView</a></li>
            
                <li><a href="../classes/Panels.PanelColumnDataGroup.html">Panels.PanelColumnDataGroup</a></li>
            
                <li><a href="../classes/Panels.PanelsView.html">Panels.PanelsView</a></li>
            
                <li><a href="../classes/Panels.PanelView.html">Panels.PanelView</a></li>
            
                <li><a href="../classes/Timer.AsyncQue.html">Timer.AsyncQue</a></li>
            
                <li><a href="../classes/Timer.Timer.html">Timer.Timer</a></li>
            
                <li><a href="../classes/Tree.LeafView.html">Tree.LeafView</a></li>
            
                <li><a href="../classes/Tree.NodeRecordMixin.html">Tree.NodeRecordMixin</a></li>
            
                <li><a href="../classes/Tree.NodeView.html">Tree.NodeView</a></li>
            
                <li><a href="../classes/Tree.TreeColumnData.html">Tree.TreeColumnData</a></li>
            
                <li><a href="../classes/Tree.TreeColumnDataGroup.html">Tree.TreeColumnDataGroup</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/alerts.html">alerts</a></li>
            
                <li><a href="../modules/app-wrapper.html">app-wrapper</a></li>
            
                <li><a href="../modules/drag-drop.html">drag-drop</a></li>
            
                <li><a href="../modules/global-module.html">global-module</a></li>
            
                <li><a href="../modules/global-module-column-data.html">global-module-column-data</a></li>
            
                <li><a href="../modules/global-module-view.html">global-module-view</a></li>
            
                <li><a href="../modules/lazy-display.html">lazy-display</a></li>
            
                <li><a href="../modules/list-column-data.html">list-column-data</a></li>
            
                <li><a href="../modules/list-group.html">list-group</a></li>
            
                <li><a href="../modules/list-item.html">list-item</a></li>
            
                <li><a href="../modules/model-wrapper.html">model-wrapper</a></li>
            
                <li><a href="../modules/panel-column-data.html">panel-column-data</a></li>
            
                <li><a href="../modules/panel-views.html">panel-views</a></li>
            
                <li><a href="../modules/panels.html">panels</a></li>
            
                <li><a href="../modules/timer.html">timer</a></li>
            
                <li><a href="../modules/tree.html">tree</a></li>
            
                <li><a href="../modules/tree-column-data.html">tree-column-data</a></li>
            
                <li><a href="../modules/tree-nodes.html">tree-nodes</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/js/main/form.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
Form = Ember.Namespace.create();

Form.MultiColumnMixin = Ember.Mixin.create({
  parentForRows : function() {
    return this;
  }.property(),

  columnDataGroup : null,

  filteredCols : function() {
    var cols = this.get(&quot;columnDataGroup.columns&quot;), record = this.get(&quot;record&quot;), that = this;
    return cols.filter(function(col) {
      return that.canAddCol(col, record);
    });
  }.property(&#x27;columnDataGroup.columns.@each.form&#x27;, &#x27;view.columnDataGroup.columns.@each.form&#x27;, &#x27;record.isNew&#x27;, &#x27;view.record.isNew&#x27;),

  canAddCol : function(col, record) {
    return !col.get(&#x27;form.isOnlyTable&#x27;) &amp;&amp; (!col.get(&quot;form.removeOnEdit&quot;) || !record || record.get(&quot;isNew&quot;)) &amp;&amp; (!col.get(&quot;form.removeOnNew&quot;) || !record || !record.get(&quot;isNew&quot;));
  },

  template : Ember.Handlebars.compile(&#x27;&#x27; +
    &#x27;{{#with view as thatView}}&#x27; +
      &#x27;{{#each thatView.filteredCols}}&#x27; +
        &#x27;{{view form.formType record=thatView.record col=this labelWidthClass=thatView.columnDataGroup.form.labelWidthClass inputWidthClass=thatView.columnDataGroup.form.inputWidthClass &#x27; +
                             &#x27;tagName=thatView.columnDataGroup.form.tagName showLabel=thatView.columnDataGroup.form.showLabel parentForm=thatView.parentForRows immediateParent=thatView}}&#x27; +
      &#x27;{{/each}}&#x27; +
    &#x27;{{/with}}&#x27; +
  &#x27;&#x27;),
});

Form.MultiInputViewParentMixin = Ember.Mixin.create({
  init : function() {
    this._super();
    this.set(&quot;listenToMap&quot;, this.get(&quot;listenToMap&quot;) || {});
    this.set(&quot;duplicateCheckMap&quot;, this.get(&quot;duplicateCheckMap&quot;) || {});
  },
  listenToMap : null,

  bubbleValChange : function(col, val, oldVal, callingView) {
    var listenToMap = this.get(&quot;listenToMap&quot;), thisCol = this.get(&quot;col&quot;),
        parentForm = this.get(&quot;parentForm&quot;);
    if(thisCol) {
      var checkDuplicates = thisCol.get(&quot;checkDuplicates&quot;);
      if(checkDuplicates &amp;&amp; checkDuplicates.contains(col.name)) {
        console.log(checkDuplicates);
      }
    }
    if(listenToMap[col.name]) {
      listenToMap[col.name].forEach(function(listening) {
        var listeningViews = listening.get(&quot;views&quot;);
        for(var i = 0; i &lt; listeningViews.length; i++) {
          var view = listeningViews[i];
          if(view !== this.callingView) {
            view.colValueChanged(col, val, oldVal);
          }
          if(view.get(&quot;col.form.bubbleValues&quot;) &amp;&amp; parentForm &amp;&amp; parentForm.bubbleValChange) parentForm.bubbleValChange(col, val, oldVal, callingView);
        }
      }, {val : val, col : col, callingView : callingView});
    }
    if(!Ember.isNone(oldVal) &amp;&amp; this.get(&quot;record&quot;)) {
      this.get(&quot;record&quot;).set(&quot;tmplPropChangeHook&quot;, col.name);
    }
  },

  registerForValChange : function(colView, listenColName) {
    var listenToMap = this.get(&quot;listenToMap&quot;), existing,
        callingCol = colView.get(&quot;col&quot;),
        colName = callingCol.get(&quot;name&quot;),
        parentForm = this.get(&quot;parentForm&quot;);
    if(callingCol.get(&quot;form.bubbleValues&quot;) &amp;&amp; parentForm &amp;&amp; parentForm.registerForValChange) parentForm.registerForValChange(colView, listenColName);
    if(!listenToMap) {
      listenToMap = {};
      this.set(&quot;listenToMap&quot;, listenToMap);
    }
    listenToMap[listenColName] = listenToMap[listenColName] || [];
    existing = listenToMap[listenColName].findBy(&quot;name&quot;, colName);
    if(existing) {
      existing.get(&quot;views&quot;).pushObject(colView);
    }
    else {
      listenToMap[listenColName].pushObject(Ember.Object.create({views : [colView], name : colName}));
    }
  },

  unregisterForValChange : function(colView, listenColName) {
    var listenToMap = this.get(&quot;listenToMap&quot;), callingCol = colView.get(&quot;col&quot;),
        colName = callingCol.get(&quot;name&quot;),
        colListener = listenToMap &amp;&amp; listenToMap[listenColName],
        existing = colListener &amp;&amp; listenToMap[listenColName].findBy(&quot;name&quot;, colName),
        parentForm = this.get(&quot;parentForm&quot;);
    if(callingCol.get(&quot;form.bubbleValues&quot;) &amp;&amp; parentForm &amp;&amp; parentForm.unregisterForValChange) parentForm.unregisterForValChange(colView, listenColName);
    if(existing) {
      var existingViews = existing.get(&quot;views&quot;);
      existingViews.removeObject(colView);
      if(existingViews.length === 0) {
        colListener.removeObject(existing);
      }
      else {
        for(var i = 0; i &lt; existingViews.length; i++) {
          existingViews[i].colValueChanged(Ember.Object.create({name : listenColName, key : listenColName}), null, null);
        }
      }
    }
  },
});

Form.FormView = Ember.View.extend(Form.MultiColumnMixin, Form.MultiInputViewParentMixin, {
  childTagNames : &#x27;div&#x27;,
  classNames : [&#x27;form-horizontal&#x27;],
});

Form.TextInputView = Ember.View.extend({
  init : function() {
    this._super();
    this.recordDidChange();
    this.registerForValChangeChild();
  },

  parentForm : null,
  immediateParent : null,
  valLength : function(){
    if(this.get(&quot;val&quot;))
      return this.get(&quot;col.form.maxlength&quot;) - this.get(&quot;val&quot;).length;
    else
      return this.get(&quot;col.form.maxlength&quot;);
  }.property(&#x27;view.val&#x27;,&#x27;val&#x27;),

  layout : Ember.Handlebars.compile(&#x27;&#x27; +
    &#x27;{{#if view.showLabelComp}}&lt;div {{bind-attr class=&quot;view.labelClass&quot;}} &gt;&#x27; +
      &#x27;&lt;label {{bind-attr for=&quot;view.col.name&quot; }}&gt;{{#if view.col.label}}{{view.col.label}}{{#if view.col.form.mandatory}}*{{/if}}{{/if}}&lt;/label&gt;&#x27; +
      &#x27;{{#if view.col.form.helpText}}&lt;div class=&quot;label-tooltip&quot;&gt;&#x27; +
        &#x27;{{#tool-tip placement=&quot;right&quot; title=view.col.form.helpText}}&lt;span class=&quot;glyphicon glyphicon-question-sign&quot;&gt;&lt;/span&gt;{{/tool-tip}}&#x27; +
      &#x27;&lt;/div&gt;{{/if}}&#x27; +
    &#x27;&lt;/div&gt;{{/if}}&#x27;+
    &#x27;&lt;div {{bind-attr class=&quot;view.inputClass&quot;}}&gt; {{#if view.col.form.fieldDescription}}&lt;span&gt;{{view.col.form.fieldDescription}}&lt;/span&gt;{{/if}}&#x27; +
      &#x27;&lt;div class=&quot;validateField&quot;&gt;&#x27;+
        &#x27;{{yield}}&#x27; +
        &#x27;{{#unless view.showLabelComp}}&#x27;+
          &#x27;{{#if view.col.form.helpText}}&lt;div class=&quot;label-tooltip&quot;&gt;&#x27; +
            &#x27;{{#tool-tip placement=&quot;right&quot; title=view.col.form.helpText}}&lt;span class=&quot;glyphicon glyphicon-question-sign&quot;&gt;&lt;/span&gt;{{/tool-tip}}&#x27; +
          &#x27;&lt;/div&gt;{{/if}}&#x27; +
        &#x27;{{/unless}}&#x27;+
        &#x27;{{#if view.col.form.maxlength}}&#x27;+
          &#x27;&lt;span class=&quot;maxlength&quot;&gt;&lt;span&gt;{{ view.valLength}}&lt;/span&gt;&lt;/span&gt;&#x27;+
        &#x27;{{/if}}&#x27;+
        &#x27;{{#if view.invalid}}&#x27; +
          &#x27;{{#if view.invalidReason}}&lt;span class=&quot;help-block text-danger&quot;&gt;{{view.invalidReason}}&lt;/span&gt;{{/if}}&#x27; +
        &#x27;{{/if}}&#x27; +
      &#x27;&lt;/div&gt;&#x27;+
    &#x27;&lt;/div&gt;&#x27; +
  &#x27;&#x27;),
  template : Ember.Handlebars.compile(&#x27;{{input class=&quot;form-control&quot; autofocus=view.col.form.autofocus type=&quot;text&quot; value=view.val disabled=view.isDisabled &#x27; +
                                                                   &#x27;placeholder=view.col.form.placeholderActual maxlength=view.col.form.maxlength}}&#x27;),
  classNames : [&#x27;form-group&#x27;],
  classNameBindings : [&#x27;col.form.additionalClass&#x27;, &#x27;col.validation.validations:has-validations&#x27;, &#x27;invalid:has-error&#x27;, &#x27;:has-feedback&#x27;, &#x27;disabled:hidden&#x27;, &#x27;additionalClass&#x27;],
  attributeBindings : [&#x27;colName:data-column-name&#x27;],
  colName : Ember.computed.alias(&quot;col.name&quot;),
  col : null,
  cols : null,
  record : null,
  labelWidthClass : &quot;col-full&quot;,
  inputWidthClass : &quot;col-sm-8&quot;,
  showLabel : true,
  labelClass : function() {
    var col = this.get(&quot;col&quot;), labelWidthClass = this.get(&quot;labelWidthClass&quot;);
    return &quot;control-label &quot;+(col.labelWidthClass || labelWidthClass);
  }.property(&#x27;view.col&#x27;, &#x27;view.labelWidthClass&#x27;),
  inputClass : function() {
    var col = this.get(&quot;col&quot;), inputWidthClass = this.get(&quot;inputWidthClass&quot;);
    return &quot;control-input &quot;+(col.inputWidthClass || inputWidthClass);
  }.property(&#x27;view.col&#x27;, &#x27;view.inputWidthClass&#x27;),

  isDisabled : function() {
    var col = this.get(&quot;col&quot;),record = this.get(&quot;record&quot;);
    return col.get(&quot;form.fixedValue&quot;) || ((col.get(&quot;form.disableOnEdit&quot;) &amp;&amp; record &amp;&amp; !record.get(&quot;isNew&quot;)) || (col.get(&quot;form.disableOnNew&quot;) &amp;&amp; record &amp;&amp; record.get(&quot;isNew&quot;)));
  }.property(&#x27;view.col&#x27;,&#x27;view.col.form.fixedValue&#x27;,&#x27;view.col.form.disableOnEdit&#x27;,&#x27;view.col.form.disableOnNew&#x27;),

  showLabelComp : function(){
    var col = this.get(&quot;col&quot;);
    if(col.showLabel === undefined ) return this.get(&quot;showLabel&quot;);
    return this.get(&quot;showLabel&quot;) &amp;&amp; col.showLabel;
  }.property(&#x27;showLabel&#x27;,&#x27;view.col&#x27;),

  invalid : false,
  invalidReason : false,

  disabled : false,
  disableCheck : function(changedCol, changedValue) {
    var col = this.get(&quot;col&quot;), record = this.get(&quot;record&quot;),
        disableEntry = col.get(&quot;form.disableForCols&quot;) &amp;&amp; col.get(&quot;form.disableForCols&quot;).findBy(&quot;name&quot;, changedCol.get(&quot;name&quot;));
    changedValue = changedValue || record.get(changedCol.get(&quot;key&quot;));
    if(disableEntry) {
      var eq = disableEntry.value === changedValue, dis = disableEntry.disable, en = disableEntry.enable;
      this.set(&quot;disabled&quot;, (dis &amp;&amp; eq) || (en &amp;&amp; !eq));
    }
  },
  colValueChanged : function(changedCol, changedValue, oldValue) {
    this.disableCheck(changedCol, changedValue);
    if(changedCol.get(&quot;name&quot;) === this.get(&quot;col.name&quot;)) {
      var that = this;
      //The delay is added cos destroy on the view of removed record is called before it is actually removed from array
      //TODO : find a better way to do this check
      Timer.addToQue(&quot;duplicateCheck-&quot;+Utils.getEmberId(this), 100).then(function() {
        if(!that.get(&quot;isDestroyed&quot;)) {
          that.validateValue(that.get(&quot;val&quot;));
        }
      });
    }
  },

  validateValue : function(value) {
    var col = this.get(&quot;col&quot;), record = this.get(&quot;record&quot;);
    if(col.get(&quot;validate&quot;)) {
      if(!this.get(&quot;disabled&quot;)) {
        var validVal = col.validateValue(value, record);
        if(validVal[0]) record._validation[col.name] = 1;
        else delete record._validation[col.name];
        this.set(&quot;invalid&quot;, validVal[0]);
        this.set(&quot;invalidReason&quot;, !Ember.isEmpty(validVal[1]) &amp;&amp; validVal[1]);
      }
      else {
        delete record._validation[col.name];
      }
    }
    record.set(&quot;validationFailed&quot;, Utils.hashHasKeys(record._validation));
  },

  val : function(key, value) {
    var col = this.get(&quot;col&quot;), record = this.get(&quot;record&quot;),
        parentForm = this.get(&quot;parentForm&quot;);
    if(!record) return value;
    record._validation = record._validation || {};
    if(arguments.length &gt; 1) {
      if(!(record instanceof DS.Model) || (record.currentState &amp;&amp; !record.currentState.stateName.match(&quot;deleted&quot;))) {
        var oldVal = record.get(col.get(&quot;key&quot;));
        this.validateValue(value);
        if(record.get(&quot;isSaving&quot;)) {
          this.set(&quot;delayedUpdate&quot;, value);
        }
        else {
          //TODO : find a better way to fix value becoming null when selection changes
          //can be observed for repeatAdsFromSlot on adunit
          if(value || !col.get(&quot;form.cantBeNull&quot;)) {
            record.set(col.get(&quot;key&quot;), value);
            this.valueDidChange(value);
            if(parentForm &amp;&amp; parentForm.bubbleValChange) parentForm.bubbleValChange(col, value, oldVal, this);
          }
        }
      }
      return value;
    }
    else {
      value = record.get(col.get(&quot;key&quot;));
      this.validateValue(value);
      if(parentForm &amp;&amp; parentForm.bubbleValChange) parentForm.bubbleValChange(col, value, null, this);
      return value;
    }
  }.property(&#x27;col&#x27;, &#x27;col.form.disabled&#x27;, &#x27;view.disabled&#x27;, &#x27;disabled&#x27;),

  valueDidChange : function(value) {
  },

  delayedUpdate : null,
  flushChanges : function() {
    var col = this.get(&quot;col&quot;), record = this.get(&quot;record&quot;),
        delayedUpdate = this.get(&quot;delayedUpdate&quot;);
    if(delayedUpdate &amp;&amp; !record.get(&quot;isSaving&quot;)) {
      var oldVal = record.get(col.get(&quot;key&quot;));
      //if(delayedUpdate.trim) delayedUpdate = delayedUpdate.trim();
      record.set(col.name, delayedUpdate);
      if(this.get(&quot;parentForm&quot;) &amp;&amp; this.get(&quot;parentForm&quot;).bubbleValChange) this.get(&quot;parentForm&quot;).bubbleValChange(col, value, oldVal, this);
      this.set(&quot;delayedUpdate&quot;, null);
      this.valueDidChange(value);
    }
  }.observes(&#x27;view.record.isSaving&#x27;, &#x27;record.isSaving&#x27;),

  prevRecord : null,
  recordDidChange : function() {
    var record = this.get(&quot;record&quot;), prevRecord = this.get(&quot;prevRecord&quot;),
        col = this.get(&quot;col&quot;);
    if(prevRecord) {
      Ember.removeObserver(prevRecord, col.name, this, &quot;notifyValChange&quot;);
    }
    if(record) {
      this.recordChangeHook();
      Ember.addObserver(record, col.name, this, &quot;notifyValChange&quot;);
      this.set(&quot;prevRecord&quot;, record);
      this.notifyPropertyChange(&quot;val&quot;);
      if(col.get(&quot;form.disableForCols&quot;)) {
        col.get(&quot;form.disableForCols&quot;).forEach(function(disableCol) {
          this.disableCheck(disableCol);
        }, this);
      }
    }
    else {
      this.recordRemovedHook();
    }
  }.observes(&quot;view.record&quot;, &quot;record&quot;),
  recordChangeHook : function() {
    this.notifyPropertyChange(&#x27;isDisabled&#x27;);
  },
  recordRemovedHook : function(){
  },
  title : &quot;test&quot;,

  notifyValChange : function(obj, val) {
    this.notifyPropertyChange(&quot;val&quot;);
    this.valueDidChange(this.get(&quot;val&quot;));
  },

  registerForValChangeChild : function() {
    var col = this.get(&quot;col&quot;), parentForm = this.get(&quot;parentForm&quot;);
    if(col.get(&quot;form.listenForCols&quot;)) {
      col.get(&quot;form.listenForCols&quot;).forEach(function(listenCol) {
        if(parentForm &amp;&amp; parentForm.registerForValChange) parentForm.registerForValChange(this, listenCol);
      }, this);
    }
  },

  unregisterForValChangeChild : function() {
    var col = this.get(&quot;col&quot;), parentForm = this.get(&quot;parentForm&quot;);
    if(col.get(&quot;form.listenForCols&quot;)) {
      col.get(&quot;form.listenForCols&quot;).forEach(function(listenCol) {
        if(parentForm &amp;&amp; parentForm.unregisterForValChange) parentForm.unregisterForValChange(this, listenCol);
      }, this);
    }
  },

  destroy : function() {
    this._super();
    this.unregisterForValChangeChild();
  },
});

Form.TextAreaView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;{{textarea class=&quot;form-control&quot; autofocus=&quot;view.col.form.autofocus&quot; value=view.val disabled=view.isDisabled rows=view.col.rows cols=view.col.cols &#x27; +
                                                                      &#x27;placeholder=view.col.form.placeholderActual maxlength=view.col.form.maxlength readonly=view.col.form.readonly}}&#x27;),
});

Form.MultipleValue = Ember.Object.extend({
  val : function(key, value) {
    var col = this.get(&quot;col&quot;);
    if(arguments.length &gt; 1) {
      if(!Ember.isNone(col)) {
        var validation = col.validateValue(value, null, col.get(&quot;validation.eachValidations&quot;));
        if(validation[0]) {
          this.set(&quot;isInvalid&quot;, true);
        }
        else {
          this.set(&quot;isInvalid&quot;, false);
        }
      }
      return value;
    }
  }.property(&#x27;col&#x27;),
  label : &quot;&quot;,
  isInvalid : false,
});
Form.CopyValuesToObject = function(obj, col, record, value) {
  var copyAttrs = col.get(&quot;form.copyAttrs&quot;),
      staticAttrs = col.get(&quot;form.staticAttrs&quot;),
      valAttrs = col.get(&quot;form.valAttrs&quot;);
  if(copyAttrs) {
    for(var k in copyAttrs) {
      if(copyAttrs.hasOwnProperty(k)) {
        obj[copyAttrs[k]] = record.get(k);
      }
    }
  }
  if(staticAttrs) {
    for(var k in staticAttrs) {
      if(staticAttrs.hasOwnProperty(k)) {
        obj[k] = staticAttrs[k];
      }
    }
  }
  if(value &amp;&amp; valAttrs) {
    for(var k in valAttrs) {
      if(valAttrs.hasOwnProperty(k)) {
        obj[valAttrs[k]] = value.get(k);
      }
    }
  }
};
Form.CopyValuesToRecord = function(toRecord, col, fromRecord, value) {
  var copyAttrs = col.get(&quot;form.copyAttrs&quot;),
      staticAttrs = col.get(&quot;form.staticAttrs&quot;),
      valAttrs = col.get(&quot;form.valAttrs&quot;);
  if(copyAttrs) {
    for(var k in copyAttrs) {
      if(copyAttrs.hasOwnProperty(k)) {
        toRecord.set(copyAttrs[k], fromRecord.get(k));
      }
    }
  }
  if(staticAttrs) {
    for(var k in staticAttrs) {
      if(staticAttrs.hasOwnProperty(k)) {
        toRecord.set(k, staticAttrs[k]);
      }
    }
  }
  if(value &amp;&amp; valAttrs) {
    for(var k in valAttrs) {
      if(valAttrs.hasOwnProperty(k)) {
        toRecord.set(valAttrs[k], value.get(k));
      }
    }
  }
};
Form.MultipleValueMixin = Ember.Mixin.create({
  init : function() {
    this._super();
    var values = this.get(&quot;values&quot;);
    this.set(&quot;values&quot;, Ember.isEmpty(values) ? [] : values);
    if(this.get(&quot;val&quot;)) this.valArrayDidChange();
    else this.valuesArrayDidChange();
  },

  values : Utils.hasMany(Form.MultipleValue),

  valuesCount : function() {
    return this.get(&quot;values.length&quot;) || 0;
  }.property(&#x27;values.@each&#x27;),

  valuesArrayDidChange : function() {
    if(!this.get(&quot;values&quot;) || this.get(&quot;lock&quot;)) return;
    var val = this.get(&quot;val&quot;), values = this.get(&quot;values&quot;),
        valLength = val &amp;&amp; val.get(&quot;length&quot;), valuesLength = values.get(&quot;length&quot;),
        col = this.get(&quot;col&quot;), record = this.get(&quot;record&quot;);
    if(val) {
      this.set(&quot;lock&quot;, true);
      values.forEach(function(value, idx) {
        var valObj = this.val.objectAt(idx);
        if(valObj) {
          valObj.set(this.col.get(&quot;form.arrayCol&quot;), value.get(&quot;val&quot;));
          Form.CopyValuesToRecord(valObj, this.col, this.record, value);
        }
        else {
          var data = { /*id : col.get(&quot;name&quot;)+&quot;__&quot;+csvid++*/ };
          data[this.col.get(&quot;form.arrayCol&quot;)] = value.get(&quot;val&quot;);
          Form.CopyValuesToObject(data, this.col, this.record, value);
          this.record.addToProp(this.col.get(&quot;key&quot;), CrudAdapter.createRecordWrapper(this.record.store, this.col.get(&quot;form.arrayType&quot;), data));
        }
      }, {val : val, col : col, record : record});
      if(valLength &gt; valuesLength) {
        for(var i = valuesLength; i &lt; valLength; i++) {
          val.popObject();
        }
      }
      this.set(&quot;lock&quot;, false);
    }
  }.observes(&#x27;values.@each.val&#x27;, &#x27;view.values.@each.val&#x27;),

  valArrayDidChange : function() {
    if(this.get(&quot;lock&quot;)) return;
    var val = this.get(&quot;val&quot;), col = this.get(&quot;col&quot;);
    if(val) {
      var values, val = this.get(&quot;val&quot;);
      values = this.valuesMultiCreateHook(val);
      this.set(&quot;lock&quot;, true);
      this.set(&quot;values&quot;, values);
      this.set(&quot;lock&quot;, false);
    }
  }.observes(&#x27;val.@each&#x27;, &#x27;view.val.@each&#x27;),

  valuesMultiCreateHook : function(value) {
    if(value.map) {
      return value.map(function(e, i, a) {
        return this.valuesElementCreateHook(e);
      }, this);
    }
    return [];
  },

  valuesElementCreateHook : function(element) {
    var col = this.get(&quot;col&quot;);
    return {val : element.get(col.get(&quot;form.arrayCol&quot;)), col : col};
  },

  lock : false,

  valuesWereInvalid : function() {
    //for now arrayCol is present for all multi value columns
    //change this check if there are exceptions
    if(!this.get(&quot;col.form.arrayCol&quot;)) return;
    var values = this.get(&quot;values&quot;),
        isInvalid = !values || values.get(&quot;length&quot;) === 0 || values.anyBy(&quot;isInvalid&quot;, true),
        record = this.get(&quot;record&quot;), col = this.get(&quot;col&quot;);
    if(!record) return;
    if(this.get(&quot;disabled&quot;)) {
      delete record._validation[col.get(&quot;name&quot;)];
    }
    else {
      this.set(&quot;invalid&quot;, isInvalid);
      record._validation = record._validation || {};
      if(isInvalid) {
        record._validation[col.get(&quot;name&quot;)] = 1;
      }
      else {
        delete record._validation[col.get(&quot;name&quot;)];
      }
    }
    this.validateValue();
  }.observes(&#x27;values.@each.isInvalid&#x27;, &#x27;view.values.@each.isInvalid&#x27;, &#x27;disabled&#x27;, &#x27;view.disabled&#x27;),
});

//TODO : support multiple on static select (no requirement for now)
Form.StaticSelectView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;{{view &quot;select&quot; class=&quot;form-control&quot; content=view.col.form.options optionValuePath=&quot;content.val&quot; optionLabelPath=&quot;content.label&quot; &#x27; +
                                                      &#x27;prompt=view.col.form.prompt value=view.val disabled=view.isDisabled maxlength=view.col.form.maxlength}}&#x27; +
                                      &#x27;{{#if view.helpblock}}&lt;p class=&quot;help-block&quot;&gt;{{view.helpblock}}&lt;/p&gt;{{/if}}&#x27;),

  helpblock : &quot;&quot;,
});

Form.DynamicSelectView = Form.StaticSelectView.extend(Form.MultipleValueMixin, Utils.ObjectWithArrayMixin, {
  init : function() {
    this._super();
    var col = this.get(&quot;col&quot;);
    Ember.addObserver(this,col.get(&quot;form.dataPath&quot;)+&quot;.@each&quot;,this,&quot;dataDidChange&quot;);
  },

  classNameBindings : [&#x27;hideOnEmpty:hidden&#x27;],
  hideOnEmpty : false,

  selectOptions : function() {
    var col = this.get(&quot;col&quot;), data = [], opts = [];
    if(col.dataPath) {
      data = Ember.get(col.dataPath) || this.get(col.dataPath);
    }
    else {
      data = col.data || [];
    }
    if(data) {
      data.forEach(function(item) {
        opts.push(Ember.Object.create({ val : item.get(col.dataValCol), label : item.get(col.dataLabelCol)}));
      }, this);
    }
    if(col.get(&quot;form.hideOnEmpty&quot;) &amp;&amp; opts.length - col.get(&quot;form.hideEmptyBuffer&quot;) === 0) {
      this.set(&quot;hideOnEmpty&quot;, true);
    }
    else {
      this.set(&quot;hideOnEmpty&quot;, false);
    }
    return opts;
  }.property(&#x27;view.col&#x27;),

  dataDidChange : function(){
    this.notifyPropertyChange(&quot;selectOptions&quot;);
    this.rerender();
  },

  selection : function(key, value) {
    if(arguments.length &gt; 1) {
      if(this._state !== &quot;preRender&quot;) {
        if(this.get(&quot;col.form.multiple&quot;)) {
          if(Ember.isEmpty(value[0])) {
            //initially the selection is an array with undef as its 1st element
            //this.set(&quot;values&quot;, []);
          }
          else {
            this.set(&quot;values&quot;, value); 
          }
        }
        else {
          this.set(&quot;val&quot;, value &amp;&amp; value.val);
        }
      }
      return value;
    }
    else {
      var options = this.get(&quot;selectOptions&quot;), sel;
      if(this.get(&quot;col.form.multiple&quot;)) {
        var values = this.get(&quot;values&quot;), col = this.get(&quot;col&quot;);
        if(values &amp;&amp; values.get(&quot;length&quot;)) {
          sel = options.filter(function(e, i, a) {
            return !!this.values.findBy(&quot;val&quot;, e.get(&quot;val&quot;));
          }, {col : col, values : values});
        }
      }
      else {
        sel = options.findBy(&quot;val&quot;, this.get(&quot;val&quot;));
      }
      return sel;
    }
  }.property(&quot;view.values.@each&quot;, &quot;values.@each&quot;),

  recordChangeHook : function() {
    this._super();
    this.notifyPropertyChange(&quot;selection&quot;);
  },

  valueDidChange : function() {
    this.notifyPropertyChange(&quot;selection&quot;);
  },

  selectionWasAdded : function(addedSels, idxs, fromSetFunc) {
    if(this.get(&quot;col.form.multiple&quot;) &amp;&amp; !fromSetFunc) {
      this.set(&quot;values&quot;, this.get(&quot;selection&quot;));
    }
  },

  arrayProps : [&quot;selection&quot;],

  template : Ember.Handlebars.compile(&#x27;{{view &quot;select&quot; class=&quot;form-control&quot; content=view.selectOptions optionValuePath=&quot;content.val&quot; optionLabelPath=&quot;content.label&quot; multiple=view.col.form.multiple &#x27;+
                                                      &#x27;prompt=view.col.form.prompt selection=view.selection disabled=view.isDisabled maxlength=view.col.form.maxlength}}&#x27;),
});

Form.SelectiveSelectView = Ember.Select.extend({
  options : [],
  filterColumn : &quot;&quot;,
  content : function() {
    var filterColumn = this.get(&quot;filterColumn&quot;);
    return this.get(&quot;options&quot;).filter(function(item) {
      return !Ember.isEmpty(item.get(this.filterColumn));
    }, {filterColumn : filterColumn});
  }.property(&#x27;view.overallOptions.@each&#x27;),
});

Form.LabelView = Form.TextInputView.extend({
  layout : Ember.Handlebars.compile(&#x27;{{yield}}&#x27;),
  template : Ember.Handlebars.compile(&#x27;&lt;label&gt;{{view.col.label}}&lt;/label&gt;&#x27;),
  col : null,
  record : null,
});

Form.Legend = Ember.View.extend({
  classNameBindings : [&#x27;col.disabled:hidden&#x27;],
  template : Ember.Handlebars.compile(&#x27;&lt;legend&gt;{{view.col.label}}&lt;/legend&gt;&#x27;),
  col : null,
  record : null,
});

Form.FileUploadView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;&lt;button class=&quot;btn btn-default&quot; {{action &quot;loadFile&quot; target=&quot;view&quot;}} {{bind-attr disabled=&quot;view.disableBtn&quot;}}&gt;{{view.btnLabel}}&lt;/button&gt;&#x27; +
                                      &#x27;&lt;input class=&quot;hidden&quot; type=&quot;file&quot; name=&quot;files[]&quot; {{bind-attr accept=&quot;view.col.form.accept&quot;}}&gt;&#x27;),

  disableBtn : false,
  fileName : &quot;&quot;,

  btnLabel : function(){
    return this.get(&#x27;uploadBtnLabel&#x27;) || this.get(&#x27;col&#x27;).get(&#x27;form.btnLabel&#x27;);
  }.property(&#x27;col&#x27;,&#x27;col.form.btnLabel&#x27;),

  postRead : function(data) {
    this.set(&quot;val&quot;, data);
  },

  postFail : function(message) {
    this.set(&quot;val&quot;, null);
  },

  change : function(event) {
    var files = event.originalEvent &amp;&amp; event.originalEvent.target.files, that = this, col = this.get(&quot;col&quot;);
    if(files &amp;&amp; files.length &gt; 0 &amp;&amp; !Ember.isEmpty(files[0])) {
      this.set(&quot;disableBtn&quot;, &quot;disabled&quot;);
      this.set(&quot;fileName&quot;, files[0].name);
      EmberFile[col.get(&quot;method&quot;)](files[0]).then(function(data) {
        that.postRead(data);
        that.set(&quot;disableBtn&quot;, false);
      }, function(message) {
        that.postFail(message);
        that.set(&quot;disableBtn&quot;, false);
      });
      $(this.get(&quot;element&quot;)).find(&quot;input[type=&#x27;file&#x27;]&quot;)[0].value = &quot;&quot;;
    }
  },

  actions : {
    loadFile : function() {
      fileInput = $(this.get(&quot;element&quot;)).find(&quot;input[type=&#x27;file&#x27;]&quot;);
      fileInput.click();
    },
  },
});

Form.ImageUploadView = Form.FileUploadView.extend({
  template : Ember.Handlebars.compile(&#x27;&lt;p&gt;&lt;button class=&quot;btn btn-default btn-sm&quot; {{action &quot;loadFile&quot; target=&quot;view&quot;}} {{bind-attr disabled=&quot;view.disableBtn&quot;}}&gt;{{view.col.form.btnLabel}}&lt;/button&gt;&#x27; +
                                      &#x27;&lt;input class=&quot;hidden&quot; type=&quot;file&quot; name=&quot;files[]&quot; {{bind-attr accept=&quot;view.col.form.accept&quot;}}&gt;&lt;/p&gt;&#x27; +
                                      &#x27;&lt;canvas class=&quot;hidden&quot;&gt;&lt;/canvas&gt;&#x27; +
                                      &#x27;&lt;div {{bind-attr class=&quot;view.hasImage::hidden&quot;}}&gt;&#x27; +
                                        &#x27;&lt;div class=&quot;image-container&quot;&gt;&#x27; +
                                          &#x27;&lt;div class=&quot;image-container-inner&quot;&gt;&#x27; +
                                            &#x27;&lt;img class=&quot;the-image&quot; {{bind-attr src=&quot;view.imageSrc&quot;}}&gt;&#x27; +
                                            &#x27;&lt;div class=&quot;image-cropper&quot;&gt;&lt;/div&gt;&#x27; +
                                          &#x27;&lt;/div&gt;&#x27; +
                                        &#x27;&lt;/div&gt;&#x27; +
                                        &#x27;&lt;button class=&quot;btn btn-default btn-sm&quot; {{action &quot;cropImage&quot; target=&quot;view&quot;}}&gt;Crop&lt;/button&gt;&#x27; +
                                      &#x27;&lt;/div&gt;&#x27; +
                                      &#x27;&lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;&#x27;),

  imageSrc : &quot;&quot;,
  hasImage : false,

  postRead : function(data) {
    this.set(&quot;imageSrc&quot;, data);
    this.set(&quot;hasImage&quot;, true);
  },

  postFail : function(message) {
    this.set(&quot;imageSrc&quot;, null);
    this.set(&quot;hasImage&quot;, false);
  },

  didInsertElement : function() {
    this._super();
    var cropper = $(this.get(&quot;element&quot;)).find(&quot;.image-cropper&quot;);
    cropper.draggable({
      containment: &quot;parent&quot;,
    });
    cropper.resizable({
      containment: &quot;parent&quot;,
    });
  },

  actions : {
    cropImage : function() {
      var cropper = $(this.get(&quot;element&quot;)).find(&quot;.image-cropper&quot;),
          x = cropper.css(&quot;left&quot;), y = cropper.css(&quot;top&quot;),
          h = cropper.height(), w = cropper.width(),
          canvas = $(this.get(&quot;element&quot;)).find(&quot;canvas&quot;)[0],
          context = canvas.getContext(&quot;2d&quot;);
      x = Number(x.match(/^(\d+)px$/)[1]);
      y = Number(y.match(/^(\d+)px$/)[1]);
      context.drawImage($(this.get(&quot;element&quot;)).find(&quot;.the-image&quot;)[0], x, y, h, w, 0, 0, h, w);
      this.set(&quot;val&quot;, canvas.toDataURL());
      this.set(&quot;hasImage&quot;, false);
      cropper.css(&quot;left&quot;, 0);
      cropper.css(&quot;top&quot;, 0);
      cropper.height(100);
      cropper.width(100);
    },
  },

});

Form.CSVEntry = Form.MultipleValue.extend({
  val : function(key, value) {
    var col = this.get(&quot;col&quot;);
    if(arguments.length &gt; 1) {
      if(!Ember.isNone(col)) {
        var validation = col.validateValue(value, null, col.get(&quot;validation.eachValidations&quot;));
        if(validation[0]) {
          this.set(&quot;isInvalid&quot;, true);
          if(!this.get(&quot;validated&quot;)) {
            this.set(&quot;showInput&quot;, true);
          }
        }
        else {
          this.set(&quot;isInvalid&quot;, false);
        }
        this.set(&quot;validated&quot;, true);
      }
      return value;
    }
  }.property(&#x27;col&#x27;),
  showInput : false,
  validated : false,
  col : null,
});

//TODO : find a better way to set id
var csvid = 0;
Form.CSVDateValue = Ember.View.extend(LazyDisplay.LazyDisplayRow, {
  template : Ember.Handlebars.compile(&#x27;&#x27; +
                                      &#x27;&lt;div {{bind-attr class=&quot;:form-group view.data.isInvalid:has-error view.data.showInput:has-input view.data.showInput:has-feedback :csv-value&quot;}}&gt;&#x27; +
                                        &#x27;{{#if view.data.showInput}}&#x27; +
                                          &#x27;{{view Ember.TextField class=&quot;form-control input-sm&quot; value=view.data.val}}&#x27; +
                                          &#x27;&lt;span {{bind-attr class=&quot;:form-control-feedback&quot;}}&gt;&lt;/span&gt;&#x27; +
                                        &#x27;{{else}}&#x27; +
                                          &#x27;&lt;p class=&quot;form-control-static&quot;&gt;{{view.data.val}}&lt;/p&gt;&#x27; +
                                        &#x27;{{/if}}&#x27; +
                                      &#x27;&lt;/div&gt;&#x27; +
                                      &#x27;&#x27;),

  data : null,
});
Form.CSVDateDummyValue = Ember.View.extend(LazyDisplay.LazyDisplayDummyRow, {
  classNames : [&quot;csv-dummy-value&quot;],
  template : Ember.Handlebars.compile(&#x27;&#x27;),
});
Form.CSVDateValues = Ember.ContainerView.extend(LazyDisplay.LazyDisplayMainMixin, {
  getRowView : function(row) {
    return Form.CSVDateValue.create({
      data : row,
    });
  },

  getDummyView : function() {
    return Form.CSVDateDummyValue.create();
  },
});
Form.CSVDataInputView = Form.FileUploadView.extend(Form.MultipleValueMixin, {
  template : Ember.Handlebars.compile(&#x27;&#x27; +
                                      &#x27;{{view.col.form.description}}&#x27; +
                                      &#x27;{{#if view.hasFile}}&#x27; +
                                        &#x27;{{view.fileName}} ({{view.valuesCount}} {{view.col.form.entityPlural}})&#x27; +
                                        &#x27;&lt;button class=&quot;btn btn-link&quot; {{action &quot;remove&quot; target=&quot;view&quot;}}&gt;Remove&lt;/button&gt; | &#x27; +
                                        &#x27;&lt;button class=&quot;btn btn-link&quot; {{action &quot;replace&quot; target=&quot;view&quot;}}&gt;Replace&lt;/button&gt;&#x27; +
                                        &#x27;{{view &quot;lazyDisplay/lazyDisplay&quot; classNameBindings=&quot;:form-sm :csv-values-wrapper&quot; columnDataGroup=view.columnDataGroup rows=view.valuesTransformed}}&#x27; +
                                      &#x27;{{else}}&#x27; +
                                        &#x27;{{textarea class=&quot;form-control&quot; autofocus=&quot;view.col.form.autofocus&quot; value=view.csvVal rows=view.col.rows cols=view.col.cols &#x27; +
                                                                        &#x27;placeholder=view.col.form.placeholderActual maxlength=view.col.form.maxlength &#x27; +
                                                                        &#x27;readonly=view.col.form.readonly}}&#x27; +
                                        &#x27;&lt;div class=&quot;upload-help-text&quot;&gt;&#x27;+
                                        &#x27;&lt;button class=&quot;btn btn-default&quot; {{action &quot;loadFile&quot; target=&quot;view&quot;}} {{bind-attr disabled=&quot;view.disableBtn&quot;}}&gt;{{view.col.form.btnLabel}}&lt;/button&gt;&#x27; +
                                        &#x27;&lt;/div&gt;&#x27;+
                                      &#x27;{{/if}}&#x27; +
                                      &#x27;&lt;input class=&quot;hidden&quot; type=&quot;file&quot; name=&quot;files[]&quot; {{bind-attr accept=&quot;view.col.form.accept&quot;}}&gt;&#x27; +
                                      &#x27;&#x27;),

  /*lazyDisplayConfig : LazyDisplay.LazyDisplayConfig.create({
    rowHeight : 28,
    lazyDisplayMainClass : &quot;Form.CSVDateValues&quot;,
  }),*/
  hasFile : false,

  values : Utils.hasMany(Form.CSVEntry),
  valuesTransformed : function() {
    var values = this.get(&quot;values&quot;), valuesTransformed = [];
    valuesTransformed.pushObjects(values.filterBy(&quot;showInput&quot;, true));
    valuesTransformed.pushObjects(values.filterBy(&quot;showInput&quot;, false));
    //console.log(&quot;valuesTransformed&quot;);
    return valuesTransformed;
  }.property(&quot;view.values.@each.showInput&quot;, &quot;values.@each.showInput&quot;),
  setToValues : function(value) {
    var col = this.get(&quot;col&quot;), values = value.split(new RegExp(col.get(&quot;splitRegex&quot;)));
    //this.set(&quot;val&quot;, value);
    for(var i = 0; i &lt; values.length;) {
      if(Ember.isEmpty(values[i])) {
        values.splice(i, 1);
      }
      else {
        values.splice(i, 1, {col : col, val : values[i++]});
      }
    }
    this.set(&quot;values&quot;, values);
  },

  csvVal : function(key, value) {
    var col = this.get(&quot;col&quot;), that = this;
    if(arguments.length &gt; 1) {
      //calculate &#x27;values&#x27; after a delay to avoid multiple calcuations for every keystroke
      Timer.addToQue(&quot;csvvalues-&quot;+col.get(&quot;name&quot;), 1500).then(function() {
        if(!that.get(&quot;isDestroyed&quot;)) {
          that.setToValues(value);
        }
      });
      return value;
    }
    else {
      var values = this.get(&quot;values&quot;);
      return values &amp;&amp; values.mapBy(&quot;val&quot;).join(&quot;, &quot;);
    }
  }.property(&quot;view.values.@each&quot;, &quot;values.@each&quot;, &quot;view.row&quot;, &quot;row&quot;),

  recordChangeHook : function() {
    this._super();
    this.set(&quot;hasFile&quot;, false);
    //this.set(&quot;csvVal&quot;, &quot;&quot;);
    //this.set(&quot;values&quot;, []);
    //the validation happens after a delay. so initially set invalid to true if its a new record else false
    this.set(&quot;invalid&quot;, this.get(&quot;record.isNew&quot;));
  },

  postRead : function(data) {
    this.setToValues(data);
    this.set(&quot;hasFile&quot;, true);
  },

  postFail : function(message) {
    this.set(&quot;hasFile&quot;, false);
  },

  actions : {
    remove : function() {
      this.set(&quot;hasFile&quot;, false);
      this.set(&quot;csvVal&quot;, &quot;&quot;);
      this.setToValues(&quot;&quot;);
    },

    replace : function() {
      $(this.get(&quot;element&quot;)).find(&quot;input[type=&#x27;file&#x27;]&quot;).click();
    },
  },
});

var mulid = 0;
Form.MultiEntryView = Form.TextInputView.extend(Form.MultiInputViewParentMixin, {
  childView : function() {
    var col = this.get(&quot;col&quot;);
    return Form.TypeToCellNameMap[col.get(&quot;childCol&quot;).type];
  }.property(&quot;view.col.childCol.type&quot;),
  template : Ember.Handlebars.compile(&#x27;&#x27; +
    &#x27;&lt;div {{bind-attr class=&quot;view.col.form.multiEntryContainerClass&quot;}}&gt;&#x27; +
    &#x27;{{#with view as outerView}}&#x27; +
      &#x27;{{#each outerView.val}}&#x27; +
        &#x27;&lt;div {{bind-attr class=&quot;outerView.col.form.eachMultiEntryClass&quot;}}&gt;&#x27; +
          &#x27;&lt;div {{bind-attr class=&quot;outerView.col.form.multiEntryClass&quot;}}&gt;&#x27; +
            &#x27;{{view outerView.childView record=this col=outerView.col.childCol parentForm=outerView showLabel=column.form.showChildrenLabel immediateParent=outerView}}&#x27; +
          &#x27;&lt;/div&gt;&#x27; +
          &#x27;{{#if outerView.col.form.canManipulateEntries}}&#x27; +
            &#x27;&lt;div class=&quot;remove-entry&quot; rel=&quot;tooltip&quot; title=&quot;Delete Condition&quot;&gt;&lt;a {{action &quot;deleteEntry&quot; this target=&quot;outerView&quot;}}&gt;&#x27; +
              &#x27;&lt;span class=&quot;glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&#x27; +
            &#x27;&lt;/a&gt;&lt;/div&gt;&#x27; +
            &#x27;&lt;div class=&quot;add-entry&quot; rel=&quot;tooltip&quot; title=&quot;Add Condition&quot;&gt; &lt;a {{action &quot;addEntry&quot; target=&quot;outerView&quot;}}&gt;&#x27;+
              &#x27;&lt;span class=&quot;glyphicon glyphicon-plus&quot;&gt;&lt;/span&gt;&#x27;+
            &#x27;&lt;/a&gt;&lt;/div&gt;&#x27;+
          &#x27;{{/if}}&#x27; +
        &#x27;&lt;/div&gt;&#x27; +
      &#x27;{{else}}&#x27;+
        &#x27;{{#if outerView.col.form.canManipulateEntries}}&#x27; +
          &#x27;&lt;div class=&quot;add-first-entry&quot; rel=&quot;tooltip&quot; title=&quot;Add Condition&quot;&gt; &lt;a {{action &quot;addEntry&quot; target=&quot;outerView&quot;}}&gt;&#x27;+
            &#x27;&lt;span class=&quot;glyphicon glyphicon-plus&quot;&gt;&lt;/span&gt;&#x27;+
          &#x27;&lt;/a&gt;&lt;/div&gt;&#x27;+
        &#x27;{{/if}}&#x27; +
      &#x27;{{/each}}&#x27;+
    &#x27;{{/with}}&#x27; +
    &#x27;&lt;/div&gt;&#x27;+
    &#x27;&lt;p class=&quot;tp-rules-end-msg&quot;&gt;{{view.col.form.postInputText}}&lt;/p&gt;&#x27;
    ),

  valuesArrayDidChange : function() {
    if(this.get(&quot;record&quot;)) this.validateValue(this.get(&quot;val&quot;));
  }.observes(&quot;val.@each&quot;, &quot;view.val.@each&quot;),

  actions : {
    addEntry : function() {
      var record = this.get(&quot;record&quot;), col = this.get(&quot;col&quot;),
          entry, val = this.get(&quot;val&quot;), data = { /*id : col.get(&quot;name&quot;)+&quot;__&quot;+mulid++*/ };
      $(&#x27;.tooltip&#x27;).hide();
      Form.CopyValuesToObject(data, col, record);
      entry = CrudAdapter.createRecordWrapper(record.store, col.get(&quot;form.arrayType&quot;), data);
      if(!val) {
        val = [];
        this.set(&quot;val&quot;, val);
      }
      val.pushObject(entry);
    },

    deleteEntry : function(entry) {
      $(&#x27;.tooltip&#x27;).hide();
      var val = this.get(&quot;val&quot;);
      val.removeObject(entry);
    },
  },
});

Form.MultiInputView = Ember.View.extend(Form.MultiColumnMixin, Form.MultiInputViewParentMixin, {
  classNames : [&#x27;clearfix&#x27;],
  classNameBindings : [&#x27;col.form.additionalClass&#x27;],
  parentForRows : function() {
    if(this.get(&quot;col.form.propogateValChange&quot;)) {
      return this.get(&quot;parentForm&quot;);
    }
    else {
      return this;
    }
  }.property(),

  columnDataGroup : Ember.computed.alias(&quot;col.childColGroup&quot;),
});

Form.CheckBoxView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;&lt;div class=&quot;checkbox&quot;&gt;&lt;label&gt;{{view &quot;checkbox&quot; checked=view.val disabled=view.isDisabled}}&lt;label&gt;&lt;/label&gt; {{view.col.form.checkboxLabel}}&lt;/label&gt;&lt;/div&gt;&#x27;),
});

Form.TextAreaSelectedView = Form.TextAreaView.extend({
  init : function() {
    this._super();
    this.get(&quot;val&quot;);
  },

  valChanged : function(e) {
    var textarea = $(e.target);
    textarea.focus().select();
    Ember.run.later(function() {
      textarea.scrollTop(0);
    }, 1);
  },

  didInsertElement : function() {
    var textarea = $(this.get(&quot;element&quot;)).find(&quot;textarea&quot;), that = this;
    this._super();
    textarea.change(this.valChanged);
    Ember.run.later(function() {
      that.valChanged({target : textarea});
    }, 1000);
  },
});

Form.GroupRadioButtonView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;{{#each view.col.form.options}}&lt;div {{bind-attr class=&quot;radio view.col.form.displayInline:radio-inline&quot;}}&gt;&#x27;
    + &#x27;&lt;label&gt;{{view &quot;form/radioInput&quot; name=view.groupName value=this.val selection=view.val}}&lt;span&gt;&lt;/span&gt;{{{this.label}}}&lt;/label&gt;&lt;/div&gt; {{/each}}&#x27;
  ),
  groupName : function(){
    return Utils.getEmberId(this);
  }.property(),
});

Form.RadioInputView = Ember.View.extend({
  tagName : &quot;input&quot;,
  type : &quot;radio&quot;,
  attributeBindings : [ &quot;name&quot;, &quot;type&quot;, &quot;value&quot;, &quot;checked:checked&quot; ],
  click : function() {
    this.set(&quot;selection&quot;, this.$().val());
  },
  checked : function() {
    return this.get(&quot;value&quot;) == this.get(&quot;selection&quot;);
  }.property(&#x27;selection&#x27;)
});

Form.GroupCheckBoxView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;{{#each view.newCheckList}}&lt;div {{bind-attr class=&quot;checkbox col-md-4 view.col.form.displayInline:checkbox-inline&quot;}}&gt;&#x27;
    + &#x27;&lt;label&gt;{{view &quot;checkbox&quot; checked=this.checked disabled=view.isDisabled}}&lt;label&gt;&lt;/label&gt; {{this.checkboxLabel}}&lt;/label&gt;&lt;/div&gt;{{/each}}&#x27;),

  checkBoxDidChange : function (){
    var checkList = this.get(&quot;newCheckList&quot;);
    this.set(&quot;val&quot;,checkList.filterBy(&quot;checked&quot;,true).mapBy(&quot;id&quot;).join(&quot;,&quot;));
  }.observes(&#x27;newCheckList.@each.checked&#x27;),
  newCheckList : function() {
    var ncl = Ember.A(), ocl = this.get(&quot;col.form.checkList&quot;),
        list = this.get(&quot;record&quot;).get(this.get(&quot;col&quot;).name).split(&quot;,&quot;);
    for(var i = 0; i &lt; ocl.get(&quot;length&quot;) ; i++) {
      var op = JSON.parse(JSON.stringify(ocl[i], [&quot;checkboxLabel&quot;, &quot;id&quot;]));
      if(list.indexOf(op.id+&quot;&quot;) == -1) {
        op.checked = false;
      }
      else op.checked = true;
      ncl.pushObject(Ember.Object.create(op));
    }
    return ncl;
  }.property(&#x27;view.col.checkList&#x27;),
  notifyValChange : function(obj, val) {
    this._super();
    var list = this.get(&quot;record&quot;).get(this.get(&quot;col&quot;).name).split(&quot;,&quot;),
        newCheckList = this.get(&quot;newCheckList&quot;);
    if(newCheckList) {
      newCheckList.forEach(function(ele){
        if(list.indexOf(ele.get(&quot;id&quot;)+&quot;&quot;)==-1){
          ele.set(&quot;checked&quot;,false);
        }
        else ele.set(&quot;checked&quot;,true);
      },this);
    }
  },
});

Form.MediumHeadingView = Form.TextInputView.extend({
  template : Ember.Handlebars.compile(&#x27;&lt;label&gt;{{view.col.label}}&lt;/label&gt;&#x27;),
  layout : Ember.Handlebars.compile(&#x27;{{yield}}&#x27;),
});

//extend this to add extra content before views like Form.MultiEntryView or Form.MultiInputView
Form.WrapperView = Ember.View.extend({
  childView : function() {
    var col = this.get(&quot;col&quot;);
    return Form.TypeToCellNameMap[col.get(&quot;childCol&quot;).type];
  }.property(&quot;view.col.childCol.type&quot;),
  layout : Ember.Handlebars.compile(&#x27;{{yield}}&#x27;),
  template : Ember.Handlebars.compile(&#x27;{{create-view view.childView record=view.record col=view.col.childCol parentForm=view.parentForm immediateParent=view.immediateParent}}&#x27;),
});

Form.TypeToCellNameMap = {
  textInput : &quot;form/textInput&quot;,
  textareaInput : &quot;form/textArea&quot;,
  staticSelect : &quot;form/staticSelect&quot;,
  dynamicSelect : &quot;form/dynamicSelect&quot;,
  selectiveSelect : &quot;form/selectiveSelect&quot;,
  label : &quot;form/label&quot;,
  fileUpload : &quot;form/fileUpload&quot;,
  imageUpload : &quot;form/imageUpload&quot;,
  csvData : &quot;form/csvDataInput&quot;,
  multiEntry : &quot;form/multiEntry&quot;,
  multiInput : &quot;form/multiInput&quot;,
  checkBox : &quot;form/checkBox&quot;,
  textareaSelectedInput : &quot;form/textAreaSelected&quot;,
  groupRadioButton : &quot;form/groupRadioButton&quot;,
  groupCheckBox : &quot;form/groupCheckBox&quot;,
  sectionHeading : &quot;form/mediumHeading&quot;,
};

Ember.Select.reopen({
  _selectionDidChangeSingle: function() {
    //overriding this to fix a problem where ember was checking the actual selected object (ember object with val and label) and not the selected value
    var el = this.get(&#x27;element&#x27;);
    if (!el) { return; }

    var content = this.get(&#x27;content&#x27;),
        selection = this.get(&#x27;selection&#x27;),
        selectionIndex = content &amp;&amp; content.findBy &amp;&amp; selection ? content.indexOf(content.findBy(&quot;val&quot;, selection.val)) : -1,
        prompt = this.get(&#x27;prompt&#x27;);

    if (prompt) { selectionIndex += 1; }
    if (el) { el.selectedIndex = selectionIndex; }
  },
});


/***    FormColumnDataInterface    ***/

Form.FormColumnDataGroup = Ember.Object.extend({
  labelWidthClass : &quot;col-sm-4&quot;,
  inputWidthClass : &quot;col-sm-8&quot;,
  showLabel : true,
});

Form.FormColumnData = Ember.Object.extend({
  placeholder : null,
  placeholderActual : function() {
    var placeholder = this.get(&quot;placeholder&quot;), label = this.get(&quot;parentObj.label&quot;);
    if(placeholder) return placeholder;
    return label;
  }.property(&#x27;parentObj.label&#x27;, &#x27;placeholder&#x27;),
  type : &quot;&quot;,
  formType : function() {
    return Form.TypeToCellNameMap[this.get(&quot;type&quot;)];
  }.property(&#x27;type&#x27;),
  fixedValue : null,
  options : [],
  data : [],
  dataValCol : &quot;&quot;,
  dataLabelCol : &quot;&quot;,
  bubbleValues : false,
  cantBeNull : false,
  canManipulateEntries : true,

  multiEntryContainerClass : &quot;multi-entry-container&quot;,
  eachMultiEntryClass : &quot;each-multi-entry&quot;,
  multiEntryClass : &quot;multi-entry&quot;,
  showChildrenLabel : false,
  childrenLabelWidthClass : &quot;&quot;,
  childrenInputWidthClass : &quot;col-md-12&quot;,

  exts : Utils.hasMany(),
  disableForCols : Utils.hasMany(&quot;Form.DisableForCol&quot;),
});

Form.FormColumnDataMap = {
  textInput              : Form.FormColumnData,
  textareaInput          : Form.FormColumnData,
  staticSelect           : Form.FormColumnData,
  dynamicSelect          : Form.FormColumnData,
  selectiveSelect        : Form.FormColumnData,
  label                  : Form.FormColumnData,
  fileUpload             : Form.FormColumnData,
  imageUpload            : Form.FormColumnData,
  csvData                : Form.FormColumnData,
  multiEntry             : Form.FormColumnData,
  multiInput             : Form.FormColumnData,
  checkBox               : Form.FormColumnData,
  textareaSelectedInput  : Form.FormColumnData,
  groupRadioButton       : Form.FormColumnData,
  groupCheckBox          : Form.FormColumnData,
  sectionHeading         : Form.FormColumnData,
};

Form.DisableForCol = Ember.Object.extend({
  name : &quot;&quot;,
  value : &quot;&quot;,
  keyName : &quot;&quot;,
  //used when you need different entries for the same attr in the record
  key : function() {
    return this.get(&quot;keyName&quot;) || this.get(&quot;name&quot;);
  }.property(&quot;keyName&quot;, &quot;name&quot;),
  enable : false,
  disable : false,
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
